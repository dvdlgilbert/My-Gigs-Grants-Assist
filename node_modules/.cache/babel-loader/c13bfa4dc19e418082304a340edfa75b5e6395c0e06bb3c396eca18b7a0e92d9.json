{"ast":null,"code":"/**\r\n * Read the mock/real toggle from localStorage.\r\n * Default to true (mock mode) if not set.\r\n */function getUseMock(){var _localStorage$getItem;return JSON.parse((_localStorage$getItem=localStorage.getItem(\"use_mock\"))!==null&&_localStorage$getItem!==void 0?_localStorage$getItem:\"true\");}/**\r\n * Parse Gemini API response into GrantRecommendation[]\r\n * Assumes Gemini returns text like:\r\n * \"Grant: ...\\nFunder: ...\\nDescription: ...\"\r\n */function parseGeminiResponse(data){const recommendations=[];if(data!==null&&data!==void 0&&data.candidates){data.candidates.forEach(candidate=>{var _candidate$content$pa,_candidate$content,_candidate$content$pa2,_candidate$content$pa3,_lines$find,_lines$find2,_lines$find3;const text=(_candidate$content$pa=candidate===null||candidate===void 0?void 0:(_candidate$content=candidate.content)===null||_candidate$content===void 0?void 0:(_candidate$content$pa2=_candidate$content.parts)===null||_candidate$content$pa2===void 0?void 0:(_candidate$content$pa3=_candidate$content$pa2[0])===null||_candidate$content$pa3===void 0?void 0:_candidate$content$pa3.text)!==null&&_candidate$content$pa!==void 0?_candidate$content$pa:\"\";const lines=text.split(\"\\n\").map(l=>l.trim());const grant={funderName:((_lines$find=lines.find(l=>l.startsWith(\"Funder:\")))===null||_lines$find===void 0?void 0:_lines$find.replace(\"Funder:\",\"\").trim())||\"Unknown Funder\",grantName:((_lines$find2=lines.find(l=>l.startsWith(\"Grant:\")))===null||_lines$find2===void 0?void 0:_lines$find2.replace(\"Grant:\",\"\").trim())||\"Untitled Grant\",description:((_lines$find3=lines.find(l=>l.startsWith(\"Description:\")))===null||_lines$find3===void 0?void 0:_lines$find3.replace(\"Description:\",\"\").trim())||\"\",website:\"https://example.org\",// placeholder until Gemini provides URLs\nmatchReason:\"Generated by Gemini based on your profile\"};recommendations.push(grant);});}return recommendations;}/**\r\n * findGrants\r\n * Given a nonprofit profile, returns a list of grant recommendations.\r\n */export async function findGrants(profile){const apiKey=localStorage.getItem(\"gemini_api_key\");if(!apiKey){throw new Error(\"No Gemini API key found. Please enter your API key.\");}const USE_MOCK=getUseMock();if(USE_MOCK){const mockResults=[{funderName:\"Community Foundation of Mississippi\",grantName:\"Local Impact Grant\",description:\"Supports nonprofits addressing community needs such as food security, housing, and education.\",website:\"https://example.org/local-impact\",matchReason:\"Matches your mission to support underserved communities.\"},{funderName:\"National Arts Endowment\",grantName:\"Arts Innovation Grant\",description:\"Funds creative projects that expand access to arts and culture.\",website:\"https://example.org/arts-innovation\",matchReason:\"Aligns with your stated goals around cultural engagement.\"},{funderName:\"Green Futures Fund\",grantName:\"Sustainability Grant\",description:\"Provides resources for nonprofits working on environmental sustainability and climate resilience.\",website:\"https://example.org/sustainability\",matchReason:\"Connects with your nonprofit’s environmental initiatives.\"}];await new Promise(resolve=>setTimeout(resolve,1000));return mockResults;}const response=await fetch(\"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(apiKey)},body:JSON.stringify({contents:[{parts:[{text:\"Suggest grant opportunities for a nonprofit with the following profile:\\n                Organization: \".concat(profile.orgName,\"\\n                Mission: \").concat(profile.mission,\"\\n                Goals: \").concat(profile.goals,\"\\n                Needs: \").concat(profile.needs,\"\\n                Address: \").concat(profile.address,\"\\n                Contact: \").concat(profile.contactName,\", \").concat(profile.contactPhone,\", \").concat(profile.email,\"\\n                Website: \").concat(profile.website,\"\\n                Tax ID: \").concat(profile.taxId)}]}]})});if(!response.ok){throw new Error(\"Gemini API error: \".concat(response.statusText));}const data=await response.json();return parseGeminiResponse(data);}","map":{"version":3,"names":["getUseMock","_localStorage$getItem","JSON","parse","localStorage","getItem","parseGeminiResponse","data","recommendations","candidates","forEach","candidate","_candidate$content$pa","_candidate$content","_candidate$content$pa2","_candidate$content$pa3","_lines$find","_lines$find2","_lines$find3","text","content","parts","lines","split","map","l","trim","grant","funderName","find","startsWith","replace","grantName","description","website","matchReason","push","findGrants","profile","apiKey","Error","USE_MOCK","mockResults","Promise","resolve","setTimeout","response","fetch","method","headers","Authorization","concat","body","stringify","contents","orgName","mission","goals","needs","address","contactName","contactPhone","email","taxId","ok","statusText","json"],"sources":["C:/Users/david/My-Gigs-Grants-Assist/src/services/geminiService.ts"],"sourcesContent":["import type { NonprofitProfile, GrantRecommendation } from \"../types\";\r\n\r\n/**\r\n * Read the mock/real toggle from localStorage.\r\n * Default to true (mock mode) if not set.\r\n */\r\nfunction getUseMock(): boolean {\r\n  return JSON.parse(localStorage.getItem(\"use_mock\") ?? \"true\");\r\n}\r\n\r\n/**\r\n * Parse Gemini API response into GrantRecommendation[]\r\n * Assumes Gemini returns text like:\r\n * \"Grant: ...\\nFunder: ...\\nDescription: ...\"\r\n */\r\nfunction parseGeminiResponse(data: any): GrantRecommendation[] {\r\n  const recommendations: GrantRecommendation[] = [];\r\n\r\n  if (data?.candidates) {\r\n    data.candidates.forEach((candidate: any) => {\r\n      const text: string = candidate?.content?.parts?.[0]?.text ?? \"\";\r\n      const lines: string[] = text.split(\"\\n\").map((l: string) => l.trim());\r\n\r\n      const grant: GrantRecommendation = {\r\n        funderName:\r\n          (lines.find((l: string) => l.startsWith(\"Funder:\"))?.replace(\"Funder:\", \"\").trim() as string) ||\r\n          \"Unknown Funder\",\r\n        grantName:\r\n          (lines.find((l: string) => l.startsWith(\"Grant:\"))?.replace(\"Grant:\", \"\").trim() as string) ||\r\n          \"Untitled Grant\",\r\n        description:\r\n          (lines.find((l: string) => l.startsWith(\"Description:\"))?.replace(\"Description:\", \"\").trim() as string) ||\r\n          \"\",\r\n        website: \"https://example.org\", // placeholder until Gemini provides URLs\r\n        matchReason: \"Generated by Gemini based on your profile\",\r\n      };\r\n\r\n      recommendations.push(grant);\r\n    });\r\n  }\r\n\r\n  return recommendations;\r\n}\r\n\r\n/**\r\n * findGrants\r\n * Given a nonprofit profile, returns a list of grant recommendations.\r\n */\r\nexport async function findGrants(\r\n  profile: NonprofitProfile\r\n): Promise<GrantRecommendation[]> {\r\n  const apiKey = localStorage.getItem(\"gemini_api_key\");\r\n  if (!apiKey) {\r\n    throw new Error(\"No Gemini API key found. Please enter your API key.\");\r\n  }\r\n\r\n  const USE_MOCK = getUseMock();\r\n\r\n  if (USE_MOCK) {\r\n    const mockResults: GrantRecommendation[] = [\r\n      {\r\n        funderName: \"Community Foundation of Mississippi\",\r\n        grantName: \"Local Impact Grant\",\r\n        description:\r\n          \"Supports nonprofits addressing community needs such as food security, housing, and education.\",\r\n        website: \"https://example.org/local-impact\",\r\n        matchReason: \"Matches your mission to support underserved communities.\",\r\n      },\r\n      {\r\n        funderName: \"National Arts Endowment\",\r\n        grantName: \"Arts Innovation Grant\",\r\n        description:\r\n          \"Funds creative projects that expand access to arts and culture.\",\r\n        website: \"https://example.org/arts-innovation\",\r\n        matchReason: \"Aligns with your stated goals around cultural engagement.\",\r\n      },\r\n      {\r\n        funderName: \"Green Futures Fund\",\r\n        grantName: \"Sustainability Grant\",\r\n        description:\r\n          \"Provides resources for nonprofits working on environmental sustainability and climate resilience.\",\r\n        website: \"https://example.org/sustainability\",\r\n        matchReason: \"Connects with your nonprofit’s environmental initiatives.\",\r\n      },\r\n    ];\r\n\r\n    await new Promise((resolve) => setTimeout(resolve, 1000));\r\n    return mockResults;\r\n  }\r\n\r\n  const response = await fetch(\r\n    \"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent\",\r\n    {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${apiKey}`,\r\n      },\r\n      body: JSON.stringify({\r\n        contents: [\r\n          {\r\n            parts: [\r\n              {\r\n                text: `Suggest grant opportunities for a nonprofit with the following profile:\r\n                Organization: ${profile.orgName}\r\n                Mission: ${profile.mission}\r\n                Goals: ${profile.goals}\r\n                Needs: ${profile.needs}\r\n                Address: ${profile.address}\r\n                Contact: ${profile.contactName}, ${profile.contactPhone}, ${profile.email}\r\n                Website: ${profile.website}\r\n                Tax ID: ${profile.taxId}`,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      }),\r\n    }\r\n  );\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Gemini API error: ${response.statusText}`);\r\n  }\r\n\r\n  const data = await response.json();\r\n  return parseGeminiResponse(data);\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}