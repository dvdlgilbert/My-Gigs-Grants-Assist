{"ast":null,"code":"import { Type } from \"@google/genai\";\nfunction getAiInstance() {\n  const apiKey = process.env.REACT_APP_GEMINI_API_KEY || \"\";\n  if (!apiKey) {\n    throw new Error(\"Gemini API Key is not configured. Please ensure REACT_APP_GEMINI_API_KEY is set in your .env file.\");\n  }\n  return new GoogleGenerativeAI(apiKey);\n}\nexport async function findGrants(profile, excludeGrants = []) {\n  let exclusionPrompt = \"\";\n  if (excludeGrants.length > 0) {\n    const exclusionList = excludeGrants.map(g => `- ${g.grantName} by ${g.funderName}`).join(\"\\n\");\n    exclusionPrompt = `\\n\\nPlease provide a new list of different grants. Do NOT include any of the following previously recommended grants:\\n${exclusionList}`;\n  }\n  const prompt = `\n    Based on the following nonprofit profile, identify 5-7 potential grant opportunities. \n    For each, provide the funder name, grant name, a brief description, a website URL, and a reason why it's a good match.\n\n    Organization Name: ${profile.orgName}\n    Mission: ${profile.mission}\n    Goals: ${profile.goals}\n    Needs: ${profile.needs}\n    ${exclusionPrompt}\n    Return the data in a valid JSON array format. Do not include any introductory text or markdown formatting.\n  `;\n  try {\n    const aiClient = getAiInstance();\n    const response = await aiClient.models.generateContent({\n      model: \"gemini-2.5-flash\",\n      contents: prompt,\n      config: {\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: Type.ARRAY,\n          items: {\n            type: Type.OBJECT,\n            properties: {\n              funderName: {\n                type: Type.STRING\n              },\n              grantName: {\n                type: Type.STRING\n              },\n              description: {\n                type: Type.STRING\n              },\n              website: {\n                type: Type.STRING\n              },\n              matchReason: {\n                type: Type.STRING\n              }\n            },\n            required: [\"funderName\", \"grantName\", \"description\", \"website\", \"matchReason\"]\n          }\n        }\n      }\n    });\n    const jsonString = response.response.text(); // ✅ updated usage\n    return JSON.parse(jsonString);\n  } catch (error) {\n    console.error(\"Error finding grants:\", error);\n    throw new Error(\"Failed to fetch grant recommendations. Please check your connection and API key configuration.\");\n  }\n}\nexport async function getFormattingHelp(proposalText, grantInfo) {\n  const prompt = `\n    Act as a professional grant writing consultant. Review the following grant proposal draft. \n    Provide constructive feedback and suggestions for improvement, focusing on clarity, impact, and alignment with the funder's likely priorities. \n    Rewrite sections where necessary to improve flow and persuasiveness.\n    The response should be formatted as clean markdown.\n\n    Funder Information:\n    ${grantInfo}\n\n    Proposal Draft:\n    ---\n    ${proposalText}\n    ---\n  `;\n  try {\n    const aiClient = getAiInstance();\n    const response = await aiClient.models.generateContent({\n      model: \"gemini-2.5-flash\",\n      contents: prompt\n    });\n    return response.response.text(); // ✅ updated usage\n  } catch (error) {\n    console.error(\"Error getting formatting help:\", error);\n    throw new Error(\"Failed to get formatting help. Please check your connection and API key configuration.\");\n  }\n}","map":{"version":3,"names":["Type","getAiInstance","apiKey","process","env","REACT_APP_GEMINI_API_KEY","Error","GoogleGenerativeAI","findGrants","profile","excludeGrants","exclusionPrompt","length","exclusionList","map","g","grantName","funderName","join","prompt","orgName","mission","goals","needs","aiClient","response","models","generateContent","model","contents","config","responseMimeType","responseSchema","type","ARRAY","items","OBJECT","properties","STRING","description","website","matchReason","required","jsonString","text","JSON","parse","error","console","getFormattingHelp","proposalText","grantInfo"],"sources":["C:/Users/david/My-Gigs-Grants-Assist/src/services/geminiService.ts"],"sourcesContent":["import { GoogleGenAI, Type } from \"@google/genai\";\r\nimport type { NonprofitProfile, GrantRecommendation } from \"../types.ts\";\r\n\r\nfunction getAiInstance(): GoogleGenerativeAI {\r\n  const apiKey = process.env.REACT_APP_GEMINI_API_KEY || \"\";\r\n\r\n  if (!apiKey) {\r\n    throw new Error(\r\n      \"Gemini API Key is not configured. Please ensure REACT_APP_GEMINI_API_KEY is set in your .env file.\"\r\n    );\r\n  }\r\n\r\n  return new GoogleGenerativeAI(apiKey);\r\n}\r\n\r\nexport async function findGrants(\r\n  profile: NonprofitProfile,\r\n  excludeGrants: GrantRecommendation[] = []\r\n): Promise<GrantRecommendation[]> {\r\n  let exclusionPrompt = \"\";\r\n  if (excludeGrants.length > 0) {\r\n    const exclusionList = excludeGrants\r\n      .map((g) => `- ${g.grantName} by ${g.funderName}`)\r\n      .join(\"\\n\");\r\n    exclusionPrompt = `\\n\\nPlease provide a new list of different grants. Do NOT include any of the following previously recommended grants:\\n${exclusionList}`;\r\n  }\r\n\r\n  const prompt = `\r\n    Based on the following nonprofit profile, identify 5-7 potential grant opportunities. \r\n    For each, provide the funder name, grant name, a brief description, a website URL, and a reason why it's a good match.\r\n\r\n    Organization Name: ${profile.orgName}\r\n    Mission: ${profile.mission}\r\n    Goals: ${profile.goals}\r\n    Needs: ${profile.needs}\r\n    ${exclusionPrompt}\r\n    Return the data in a valid JSON array format. Do not include any introductory text or markdown formatting.\r\n  `;\r\n\r\n  try {\r\n    const aiClient = getAiInstance();\r\n    const response = await aiClient.models.generateContent({\r\n      model: \"gemini-2.5-flash\",\r\n      contents: prompt,\r\n      config: {\r\n        responseMimeType: \"application/json\",\r\n        responseSchema: {\r\n          type: Type.ARRAY,\r\n          items: {\r\n            type: Type.OBJECT,\r\n            properties: {\r\n              funderName: { type: Type.STRING },\r\n              grantName: { type: Type.STRING },\r\n              description: { type: Type.STRING },\r\n              website: { type: Type.STRING },\r\n              matchReason: { type: Type.STRING },\r\n            },\r\n            required: [\r\n              \"funderName\",\r\n              \"grantName\",\r\n              \"description\",\r\n              \"website\",\r\n              \"matchReason\",\r\n            ],\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    const jsonString = response.response.text(); // ✅ updated usage\r\n    return JSON.parse(jsonString) as GrantRecommendation[];\r\n  } catch (error) {\r\n    console.error(\"Error finding grants:\", error);\r\n    throw new Error(\r\n      \"Failed to fetch grant recommendations. Please check your connection and API key configuration.\"\r\n    );\r\n  }\r\n}\r\n\r\nexport async function getFormattingHelp(\r\n  proposalText: string,\r\n  grantInfo: string\r\n): Promise<string> {\r\n  const prompt = `\r\n    Act as a professional grant writing consultant. Review the following grant proposal draft. \r\n    Provide constructive feedback and suggestions for improvement, focusing on clarity, impact, and alignment with the funder's likely priorities. \r\n    Rewrite sections where necessary to improve flow and persuasiveness.\r\n    The response should be formatted as clean markdown.\r\n\r\n    Funder Information:\r\n    ${grantInfo}\r\n\r\n    Proposal Draft:\r\n    ---\r\n    ${proposalText}\r\n    ---\r\n  `;\r\n\r\n  try {\r\n    const aiClient = getAiInstance();\r\n    const response = await aiClient.models.generateContent({\r\n      model: \"gemini-2.5-flash\",\r\n      contents: prompt,\r\n    });\r\n    return response.response.text(); // ✅ updated usage\r\n  } catch (error) {\r\n    console.error(\"Error getting formatting help:\", error);\r\n    throw new Error(\r\n      \"Failed to get formatting help. Please check your connection and API key configuration.\"\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}