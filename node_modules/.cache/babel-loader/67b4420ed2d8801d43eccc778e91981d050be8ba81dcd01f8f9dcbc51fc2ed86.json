{"ast":null,"code":"/**\r\n * Read the mock/real toggle from localStorage.\r\n * Default to true (mock mode) if not set.\r\n */\nfunction getUseMock() {\n  var _localStorage$getItem;\n  return JSON.parse((_localStorage$getItem = localStorage.getItem(\"use_mock\")) !== null && _localStorage$getItem !== void 0 ? _localStorage$getItem : \"true\");\n}\n\n/**\r\n * Parse Gemini API response into GrantRecommendation[]\r\n * Assumes Gemini returns text like:\r\n * \"Grant: ...\\nFunder: ...\\nDescription: ...\"\r\n */\nfunction parseGeminiResponse(data) {\n  const recommendations = [];\n  if (data !== null && data !== void 0 && data.candidates) {\n    data.candidates.forEach(candidate => {\n      var _candidate$content$pa, _candidate$content, _candidate$content$pa2, _candidate$content$pa3, _lines$find, _lines$find2, _lines$find3;\n      const text = (_candidate$content$pa = candidate === null || candidate === void 0 ? void 0 : (_candidate$content = candidate.content) === null || _candidate$content === void 0 ? void 0 : (_candidate$content$pa2 = _candidate$content.parts) === null || _candidate$content$pa2 === void 0 ? void 0 : (_candidate$content$pa3 = _candidate$content$pa2[0]) === null || _candidate$content$pa3 === void 0 ? void 0 : _candidate$content$pa3.text) !== null && _candidate$content$pa !== void 0 ? _candidate$content$pa : \"\";\n      const lines = text.split(\"\\n\").map(l => l.trim());\n      const grant = {\n        funderName: ((_lines$find = lines.find(l => l.startsWith(\"Funder:\"))) === null || _lines$find === void 0 ? void 0 : _lines$find.replace(\"Funder:\", \"\").trim()) || \"Unknown Funder\",\n        grantName: ((_lines$find2 = lines.find(l => l.startsWith(\"Grant:\"))) === null || _lines$find2 === void 0 ? void 0 : _lines$find2.replace(\"Grant:\", \"\").trim()) || \"Untitled Grant\",\n        description: ((_lines$find3 = lines.find(l => l.startsWith(\"Description:\"))) === null || _lines$find3 === void 0 ? void 0 : _lines$find3.replace(\"Description:\", \"\").trim()) || \"\",\n        website: \"https://example.org\",\n        // placeholder until Gemini provides URLs\n        matchReason: \"Generated by Gemini based on your profile\"\n      };\n      recommendations.push(grant);\n    });\n  }\n  return recommendations;\n}\n\n/**\r\n * findGrants\r\n * Given a nonprofit profile, returns a list of grant recommendations.\r\n */\nexport async function findGrants(profile) {\n  const apiKey = localStorage.getItem(\"gemini_api_key\");\n  if (!apiKey) {\n    throw new Error(\"No Gemini API key found. Please enter your API key.\");\n  }\n  const USE_MOCK = getUseMock();\n  if (USE_MOCK) {\n    const mockResults = [{\n      funderName: \"Community Foundation of Mississippi\",\n      grantName: \"Local Impact Grant\",\n      description: \"Supports nonprofits addressing community needs such as food security, housing, and education.\",\n      website: \"https://example.org/local-impact\",\n      matchReason: \"Matches your mission to support underserved communities.\"\n    }, {\n      funderName: \"National Arts Endowment\",\n      grantName: \"Arts Innovation Grant\",\n      description: \"Funds creative projects that expand access to arts and culture.\",\n      website: \"https://example.org/arts-innovation\",\n      matchReason: \"Aligns with your stated goals around cultural engagement.\"\n    }, {\n      funderName: \"Green Futures Fund\",\n      grantName: \"Sustainability Grant\",\n      description: \"Provides resources for nonprofits working on environmental sustainability and climate resilience.\",\n      website: \"https://example.org/sustainability\",\n      matchReason: \"Connects with your nonprofit’s environmental initiatives.\"\n    }];\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    return mockResults;\n  }\n  const response = await fetch(\"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${apiKey}`\n    },\n    body: JSON.stringify({\n      contents: [{\n        parts: [{\n          text: `Suggest grant opportunities for a nonprofit with the following profile:\n                Organization: ${profile.orgName}\n                Mission: ${profile.mission}\n                Goals: ${profile.goals}\n                Needs: ${profile.needs}\n                Address: ${profile.address}\n                Contact: ${profile.contactName}, ${profile.contactPhone}, ${profile.email}\n                Website: ${profile.website}\n                Tax ID: ${profile.taxId}`\n        }]\n      }]\n    })\n  });\n  if (!response.ok) {\n    throw new Error(`Gemini API error: ${response.statusText}`);\n  }\n  const data = await response.json();\n  return parseGeminiResponse(data);\n}","map":{"version":3,"names":["getUseMock","_localStorage$getItem","JSON","parse","localStorage","getItem","parseGeminiResponse","data","recommendations","candidates","forEach","candidate","_candidate$content$pa","_candidate$content","_candidate$content$pa2","_candidate$content$pa3","_lines$find","_lines$find2","_lines$find3","text","content","parts","lines","split","map","l","trim","grant","funderName","find","startsWith","replace","grantName","description","website","matchReason","push","findGrants","profile","apiKey","Error","USE_MOCK","mockResults","Promise","resolve","setTimeout","response","fetch","method","headers","Authorization","body","stringify","contents","orgName","mission","goals","needs","address","contactName","contactPhone","email","taxId","ok","statusText","json"],"sources":["C:/Users/david/My-Gigs-Grants-Assist/src/services/geminiService.ts"],"sourcesContent":["import type { NonprofitProfile, GrantRecommendation } from \"../types\";\r\n\r\n/**\r\n * Read the mock/real toggle from localStorage.\r\n * Default to true (mock mode) if not set.\r\n */\r\nfunction getUseMock(): boolean {\r\n  return JSON.parse(localStorage.getItem(\"use_mock\") ?? \"true\");\r\n}\r\n\r\n/**\r\n * Parse Gemini API response into GrantRecommendation[]\r\n * Assumes Gemini returns text like:\r\n * \"Grant: ...\\nFunder: ...\\nDescription: ...\"\r\n */\r\nfunction parseGeminiResponse(data: any): GrantRecommendation[] {\r\n  const recommendations: GrantRecommendation[] = [];\r\n\r\n  if (data?.candidates) {\r\n    data.candidates.forEach((candidate: any) => {\r\n      const text: string = candidate?.content?.parts?.[0]?.text ?? \"\";\r\n      const lines: string[] = text.split(\"\\n\").map((l: string) => l.trim());\r\n\r\n      const grant: GrantRecommendation = {\r\n        funderName:\r\n          (lines.find((l: string) => l.startsWith(\"Funder:\"))?.replace(\"Funder:\", \"\").trim() as string) ||\r\n          \"Unknown Funder\",\r\n        grantName:\r\n          (lines.find((l: string) => l.startsWith(\"Grant:\"))?.replace(\"Grant:\", \"\").trim() as string) ||\r\n          \"Untitled Grant\",\r\n        description:\r\n          (lines.find((l: string) => l.startsWith(\"Description:\"))?.replace(\"Description:\", \"\").trim() as string) ||\r\n          \"\",\r\n        website: \"https://example.org\", // placeholder until Gemini provides URLs\r\n        matchReason: \"Generated by Gemini based on your profile\",\r\n      };\r\n\r\n      recommendations.push(grant);\r\n    });\r\n  }\r\n\r\n  return recommendations;\r\n}\r\n\r\n/**\r\n * findGrants\r\n * Given a nonprofit profile, returns a list of grant recommendations.\r\n */\r\nexport async function findGrants(\r\n  profile: NonprofitProfile\r\n): Promise<GrantRecommendation[]> {\r\n  const apiKey = localStorage.getItem(\"gemini_api_key\");\r\n  if (!apiKey) {\r\n    throw new Error(\"No Gemini API key found. Please enter your API key.\");\r\n  }\r\n\r\n  const USE_MOCK = getUseMock();\r\n\r\n  if (USE_MOCK) {\r\n    const mockResults: GrantRecommendation[] = [\r\n      {\r\n        funderName: \"Community Foundation of Mississippi\",\r\n        grantName: \"Local Impact Grant\",\r\n        description:\r\n          \"Supports nonprofits addressing community needs such as food security, housing, and education.\",\r\n        website: \"https://example.org/local-impact\",\r\n        matchReason: \"Matches your mission to support underserved communities.\",\r\n      },\r\n      {\r\n        funderName: \"National Arts Endowment\",\r\n        grantName: \"Arts Innovation Grant\",\r\n        description:\r\n          \"Funds creative projects that expand access to arts and culture.\",\r\n        website: \"https://example.org/arts-innovation\",\r\n        matchReason: \"Aligns with your stated goals around cultural engagement.\",\r\n      },\r\n      {\r\n        funderName: \"Green Futures Fund\",\r\n        grantName: \"Sustainability Grant\",\r\n        description:\r\n          \"Provides resources for nonprofits working on environmental sustainability and climate resilience.\",\r\n        website: \"https://example.org/sustainability\",\r\n        matchReason: \"Connects with your nonprofit’s environmental initiatives.\",\r\n      },\r\n    ];\r\n\r\n    await new Promise((resolve) => setTimeout(resolve, 1000));\r\n    return mockResults;\r\n  }\r\n\r\n  const response = await fetch(\r\n    \"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent\",\r\n    {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${apiKey}`,\r\n      },\r\n      body: JSON.stringify({\r\n        contents: [\r\n          {\r\n            parts: [\r\n              {\r\n                text: `Suggest grant opportunities for a nonprofit with the following profile:\r\n                Organization: ${profile.orgName}\r\n                Mission: ${profile.mission}\r\n                Goals: ${profile.goals}\r\n                Needs: ${profile.needs}\r\n                Address: ${profile.address}\r\n                Contact: ${profile.contactName}, ${profile.contactPhone}, ${profile.email}\r\n                Website: ${profile.website}\r\n                Tax ID: ${profile.taxId}`,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      }),\r\n    }\r\n  );\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Gemini API error: ${response.statusText}`);\r\n  }\r\n\r\n  const data = await response.json();\r\n  return parseGeminiResponse(data);\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}